# Реферальная система Stoxly

## Обзор

Реферальная система позволяет пользователям приглашать друзей на платформу и получать вознаграждения за успешные регистрации.

## Функциональность

### 1. Регистрация с реферальным кодом

- **Автоматическое извлечение из URL**: При переходе по ссылке вида `https://stoxly.com/register?ref=CODE123` реферальный код автоматически подставляется в форму регистрации
- **Ручной ввод**: Пользователи могут ввести реферальный код вручную
- **Валидация**: Проверка формата реферального кода (3-20 символов, буквы, цифры, дефисы)
- **Очистка**: Возможность удалить введенный реферальный код

### 2. Управление рефералами

- **Реферальный код**: Уникальный код для каждого пользователя
- **Реферальная ссылка**: Автоматически генерируемая ссылка с реферальным кодом
- **Статистика**: Количество рефералов, активных рефералов, общий заработок
- **Список рефералов**: Детальная информация о приглашенных пользователях

### 3. Копирование и шаринг

- **Копирование кода**: Одним кликом скопировать реферальный код
- **Копирование ссылки**: Копирование полной реферальной ссылки
- **Нативный шаринг**: Использование Web Share API для мобильных устройств

## Структура файлов

```
src/
├── utils/
│   └── referral.js              # Утилиты для работы с реферальными кодами
├── components/
│   └── ReferralInfo.vue         # Компонент отображения реферальной информации
├── views/
│   ├── pages/auth/
│   │   └── Register.vue         # Форма регистрации с поддержкой рефералов
│   └── dashboard-pages/
│       └── Referrals.vue        # Страница управления рефералами
└── api/
    └── axios.js                 # API методы для реферальной системы
```

## API Endpoints

### Регистрация
```
POST /api/auth/register/
{
    "username": "string",
    "email": "string",
    "first_name": "string",
    "last_name": "string",
    "password": "string",
    "password2": "string",
    "referral_code": "string" // опционально
}
```

### Получение реферального кода пользователя
```
GET /api/auth/referral-code/
Response: { "referral_code": "string" }
```

### Статистика рефералов
```
GET /api/auth/referrals/stats/
Response: {
    "totalReferrals": number,
    "activeReferrals": number,
    "totalEarnings": number
}
```

### Список рефералов
```
GET /api/auth/referrals/?page=1&page_size=10
Response: {
    "results": [
        {
            "username": "string",
            "email": "string",
            "status": "active|pending|inactive",
            "joined_at": "datetime",
            "earnings": number
        }
    ],
    "count": number,
    "next": "string|null",
    "previous": "string|null"
}
```

### Валидация реферального кода
```
POST /api/auth/validate-referral-code/
{
    "referral_code": "string"
}
Response: { "valid": boolean, "message": "string" }
```

## Утилиты (src/utils/referral.js)

### extractReferralCodeFromURL(url)
Извлекает реферальный код из URL параметра `ref`

### validateReferralCode(code)
Валидирует формат реферального кода

### createReferralLink(baseUrl, referralCode)
Создает реферальную ссылку с указанным кодом

### saveReferralCode(code)
Сохраняет реферальный код в localStorage

### getSavedReferralCode()
Получает сохраненный реферальный код из localStorage

### getCurrentReferralCode()
Проверяет наличие реферального кода в URL или localStorage

## Компоненты

### ReferralInfo.vue
Основной компонент для отображения реферальной информации:
- Реферальный код пользователя
- Статистика рефералов
- Реферальная ссылка
- Список рефералов
- Функции копирования и шаринга

### Register.vue
Обновленная форма регистрации с поддержкой реферальных кодов:
- Автоматическое извлечение кода из URL
- Поле для ручного ввода
- Валидация формата
- Возможность очистки

## Использование

### 1. Регистрация с реферальным кодом

```javascript
// Автоматически извлекается из URL
// https://stoxly.com/register?ref=USER123

// Или вводится вручную в форму регистрации
```

### 2. Отображение реферальной информации

```vue
<template>
    <ReferralInfo 
        :userReferralCode="userReferralCode"
        :referralStats="referralStats"
        :referrals="referrals"
    />
</template>

<script setup>
import ReferralInfo from '@/components/ReferralInfo.vue';
</script>
```

### 3. Работа с утилитами

```javascript
import { 
    extractReferralCodeFromURL, 
    validateReferralCode,
    createReferralLink 
} from '@/utils/referral.js';

// Извлечение кода из URL
const code = extractReferralCodeFromURL();

// Валидация кода
const isValid = validateReferralCode('USER123');

// Создание ссылки
const link = createReferralLink('https://stoxly.com/register', 'USER123');
```

## Валидация

### Формат реферального кода
- Длина: 3-20 символов
- Разрешенные символы: буквы (a-z, A-Z), цифры (0-9), дефис (-)
- Регулярное выражение: `/^[a-zA-Z0-9-]{3,20}$/`

### Обработка ошибок
- Неверный формат кода
- Несуществующий реферальный код
- Попытка самореферала
- Сетевые ошибки

## Безопасность

- Валидация реферальных кодов на фронтенде и бэкенде
- Проверка на саморефералы
- Ограничение на количество рефералов (если необходимо)
- Логирование реферальных действий

## Расширение функциональности

### Возможные улучшения:
1. **Реферальные уровни**: Многоуровневая реферальная система
2. **Временные ограничения**: Ограничения по времени действия реферальных кодов
3. **Географические ограничения**: Ограничения по странам
4. **Аналитика**: Детальная аналитика реферальной активности
5. **Уведомления**: Уведомления о новых рефералах и заработках
6. **Геймификация**: Достижения и бейджи за реферальную активность

## Тестирование

### Тестовые сценарии:
1. Регистрация без реферального кода
2. Регистрация с валидным реферальным кодом из URL
3. Регистрация с валидным реферальным кодом, введенным вручную
4. Регистрация с невалидным реферальным кодом
5. Копирование реферального кода и ссылки
6. Шаринг реферальной ссылки
7. Отображение статистики рефералов
8. Пагинация списка рефералов

## Поддержка

При возникновении проблем с реферальной системой:
1. Проверьте консоль браузера на наличие ошибок
2. Убедитесь, что API endpoints доступны
3. Проверьте формат реферального кода
4. Обратитесь к документации API 